---
title: AWS VPC
description: Virtual Private Cloud - Isolated network for your AWS resources
---

Amazon Virtual Private Cloud (VPC) lets you provision a logically isolated section of the AWS Cloud where you can launch resources in a virtual network.

## VPC Architecture Overview

```mermaid
flowchart TB
    subgraph Internet
        IGW[Internet Gateway]
    end
    
    subgraph VPC["VPC 10.0.0.0/16"]
        subgraph Public["Public Subnets"]
            PS1[Public Subnet 1<br/>10.0.1.0/24]
            PS2[Public Subnet 2<br/>10.0.2.0/24]
            NAT[NAT Gateway]
        end
        
        subgraph Private["Private Subnets"]
            PRS1[Private Subnet 1<br/>10.0.10.0/24]
            PRS2[Private Subnet 2<br/>10.0.20.0/24]
        end
        
        RT1[Public Route Table]
        RT2[Private Route Table]
    end
    
    IGW --> PS1
    IGW --> PS2
    PS1 --> NAT
    NAT --> PRS1
    NAT --> PRS2
    RT1 --> PS1
    RT1 --> PS2
    RT2 --> PRS1
    RT2 --> PRS2
    
    style IGW fill:#285e61,stroke:#38b2ac,color:#fff
    style PS1 fill:#276749,stroke:#48bb78,color:#fff
    style PS2 fill:#276749,stroke:#48bb78,color:#fff
    style NAT fill:#744210,stroke:#d69e2e,color:#fff
    style PRS1 fill:#553c9a,stroke:#805ad5,color:#fff
    style PRS2 fill:#553c9a,stroke:#805ad5,color:#fff
    style RT1 fill:#2d3748,stroke:#4a5568,color:#fff
    style RT2 fill:#2d3748,stroke:#4a5568,color:#fff
```

## Key Concepts

### VPC
An isolated virtual network in AWS with its own IP address range, subnets, and routing.

### Subnets
Segments of a VPC's IP address range where you place resources.

| Type | Description |
|------|-------------|
| **Public Subnet** | Has route to Internet Gateway |
| **Private Subnet** | No direct internet access |

### CIDR Blocks
IP address ranges for your VPC and subnets.

```
VPC: 10.0.0.0/16 (65,536 IPs)
├── Public Subnet 1:  10.0.1.0/24 (256 IPs)
├── Public Subnet 2:  10.0.2.0/24 (256 IPs)
├── Private Subnet 1: 10.0.10.0/24 (256 IPs)
└── Private Subnet 2: 10.0.20.0/24 (256 IPs)
```

## Network Components

### Internet Gateway (IGW)
Enables internet access for public subnets.

```bash
aws ec2 create-internet-gateway
aws ec2 attach-internet-gateway \
  --internet-gateway-id igw-123 \
  --vpc-id vpc-456
```

### NAT Gateway
Allows private subnets to access the internet without exposing resources.

```bash
aws ec2 create-nat-gateway \
  --subnet-id subnet-public \
  --allocation-id eipalloc-123
```

### Route Tables
Define how traffic is routed within and outside the VPC.

```
Public Subnet Route Table:
10.0.0.0/16 → local
0.0.0.0/0   → igw-xxx (Internet Gateway)

Private Subnet Route Table:
10.0.0.0/16 → local
0.0.0.0/0   → nat-xxx (NAT Gateway)
```

## Security

### Security Groups
Virtual firewalls at the instance level (stateful).

```json
{
  "GroupName": "web-servers",
  "Description": "Allow HTTP/HTTPS",
  "IpPermissions": [
    {"IpProtocol": "tcp", "FromPort": 80, "ToPort": 80, "IpRanges": [{"CidrIp": "0.0.0.0/0"}]},
    {"IpProtocol": "tcp", "FromPort": 443, "ToPort": 443, "IpRanges": [{"CidrIp": "0.0.0.0/0"}]}
  ]
}
```

### Network ACLs
Subnet-level firewall (stateless).

| Rule | Type | Protocol | Port | Source | Allow/Deny |
|------|------|----------|------|--------|------------|
| 100 | Inbound | TCP | 80 | 0.0.0.0/0 | Allow |
| 110 | Inbound | TCP | 443 | 0.0.0.0/0 | Allow |
| * | Inbound | All | All | 0.0.0.0/0 | Deny |

### Security Groups vs NACLs

| Feature | Security Group | NACL |
|---------|----------------|------|
| Level | Instance | Subnet |
| State | Stateful | Stateless |
| Rules | Allow only | Allow & Deny |
| Evaluation | All rules | Rules in order |

```mermaid
flowchart LR
    subgraph Traffic["Inbound Traffic"]
        REQ[Request]
    end
    
    subgraph NACL["Network ACL - Subnet Level"]
        N1{Rule 100<br/>Allow?}
        N2{Rule 110<br/>Allow?}
        N3{Default<br/>Deny}
    end
    
    subgraph SG["Security Group - Instance Level"]
        S1{Port 443?}
        S2{Port 80?}
    end
    
    subgraph Instance
        EC2[EC2 Instance]
    end
    
    REQ --> N1
    N1 -->|Yes| SG
    N1 -->|No| N2
    N2 -->|Yes| SG
    N2 -->|No| N3
    S1 -->|Yes| EC2
    S1 -->|No| S2
    S2 -->|Yes| EC2
    
    style REQ fill:#4a5568,stroke:#718096,color:#fff
    style N1 fill:#2c5282,stroke:#4299e1,color:#fff
    style N2 fill:#2c5282,stroke:#4299e1,color:#fff
    style N3 fill:#9b2c2c,stroke:#fc8181,color:#fff
    style S1 fill:#276749,stroke:#48bb78,color:#fff
    style S2 fill:#276749,stroke:#48bb78,color:#fff
    style EC2 fill:#553c9a,stroke:#805ad5,color:#fff
```

## VPC Endpoints

Access AWS services without internet:

### Gateway Endpoints
For S3 and DynamoDB (free):

```bash
aws ec2 create-vpc-endpoint \
  --vpc-id vpc-123 \
  --service-name com.amazonaws.us-east-1.s3 \
  --route-table-ids rtb-456
```

### Interface Endpoints
For other AWS services (powered by PrivateLink):

```bash
aws ec2 create-vpc-endpoint \
  --vpc-id vpc-123 \
  --vpc-endpoint-type Interface \
  --service-name com.amazonaws.us-east-1.secretsmanager \
  --subnet-ids subnet-789 \
  --security-group-ids sg-abc
```

## VPC Peering

Connect two VPCs privately:

```mermaid
flowchart LR
    subgraph VPCA["VPC A"]
        A1[10.0.0.0/16]
        RT1[Route Table A]
    end
    
    subgraph Peering
        PC[VPC Peering<br/>Connection]
    end
    
    subgraph VPCB["VPC B"]
        B1[10.1.0.0/16]
        RT2[Route Table B]
    end
    
    A1 --> RT1
    RT1 <--> PC
    PC <--> RT2
    RT2 --> B1
    
    style A1 fill:#2c5282,stroke:#4299e1,color:#fff
    style B1 fill:#276749,stroke:#48bb78,color:#fff
    style PC fill:#553c9a,stroke:#805ad5,color:#fff
    style RT1 fill:#2d3748,stroke:#4a5568,color:#fff
    style RT2 fill:#2d3748,stroke:#4a5568,color:#fff
```

Requirements:
- Non-overlapping CIDR blocks
- Route table entries in both VPCs
- Security groups allow traffic

## VPN Connectivity

### Site-to-Site VPN
Connect on-premises network to VPC:

1. Create Virtual Private Gateway
2. Create Customer Gateway
3. Create VPN Connection
4. Configure on-premises router

### Client VPN
Allow remote users to access VPC resources.

## Transit Gateway

Hub for connecting VPCs and on-premises networks:

```mermaid
flowchart TB
    subgraph TGW["Transit Gateway"]
        HUB[Central Hub]
    end
    
    subgraph VPCs["Connected VPCs"]
        VPC1[VPC A<br/>10.0.0.0/16]
        VPC2[VPC B<br/>10.1.0.0/16]
        VPC3[VPC C<br/>10.2.0.0/16]
    end
    
    subgraph OnPrem["On-Premises"]
        DC[Data Center]
        VPN[VPN Connection]
    end
    
    VPC1 <--> HUB
    VPC2 <--> HUB
    VPC3 <--> HUB
    DC --> VPN
    VPN <--> HUB
    
    style HUB fill:#553c9a,stroke:#805ad5,color:#fff
    style VPC1 fill:#2c5282,stroke:#4299e1,color:#fff
    style VPC2 fill:#276749,stroke:#48bb78,color:#fff
    style VPC3 fill:#744210,stroke:#d69e2e,color:#fff
    style DC fill:#4a5568,stroke:#718096,color:#fff
    style VPN fill:#285e61,stroke:#38b2ac,color:#fff
```

## Flow Logs

Capture network traffic information:

```bash
aws ec2 create-flow-logs \
  --resource-type VPC \
  --resource-ids vpc-123 \
  --traffic-type ALL \
  --log-destination-type cloud-watch-logs \
  --log-group-name vpc-flow-logs
```

## Best Practices

### Design
1. Use multiple Availability Zones
2. Separate public and private subnets
3. Plan CIDR blocks for future growth
4. Use VPC endpoints for AWS services

### Security
1. Use Security Groups as primary defense
2. Use NACLs for subnet-level rules
3. Enable Flow Logs for monitoring
4. Use private subnets for sensitive resources

### Cost Optimization
1. Use VPC endpoints instead of NAT for AWS services
2. Right-size NAT Gateways
3. Delete unused elastic IPs

## Reference Architecture

```mermaid
flowchart TB
    subgraph Internet
        IGW[Internet Gateway]
    end
    
    subgraph VPC["VPC: 10.0.0.0/16"]
        subgraph PublicLayer["Public Subnets"]
            ALB[ALB / NAT]
            ALB2[ALB / NAT]
        end
        
        subgraph AppLayer["Private Subnets - App Layer"]
            APP1[EC2/ECS AZ-a]
            APP2[EC2/ECS AZ-b]
        end
        
        subgraph DataLayer["Private Subnets - Data Layer"]
            DB1[RDS/Cache AZ-a]
            DB2[RDS/Cache AZ-b]
        end
    end
    
    IGW --> PublicLayer
    PublicLayer --> AppLayer
    AppLayer --> DataLayer
    
    style IGW fill:#285e61,stroke:#38b2ac,color:#fff
    style ALB fill:#276749,stroke:#48bb78,color:#fff
    style ALB2 fill:#276749,stroke:#48bb78,color:#fff
    style APP1 fill:#2c5282,stroke:#4299e1,color:#fff
    style APP2 fill:#2c5282,stroke:#4299e1,color:#fff
    style DB1 fill:#553c9a,stroke:#805ad5,color:#fff
    style DB2 fill:#553c9a,stroke:#805ad5,color:#fff
```

## Next Steps

<Cards>
  <Card title="VPC CLI Reference" href="/docs/aws/vpc/cli" description="Complete CLI commands for VPC" />
  <Card title="API Gateway" href="/docs/aws/api-gateway" description="API Management" />
</Cards>
